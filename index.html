<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FX and Interest Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .step-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .step-row:last-child {
            border-bottom: none;
        }
        .step-label {
            color: #4b5563;
        }
        .step-value {
            font-weight: 600;
            color: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md overflow-hidden">
            <div class="p-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">FX & Interest Calculator</h1>
                <p class="text-gray-600 mb-8">Calculate your EUR to TRY conversion and potential interest earnings over a specific period.</p>

                <!-- FX Conversion Section -->
                <div class="bg-gray-50 p-6 rounded-lg mb-8">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">1. EUR to TRY Conversion</h2>
                    <p class="text-xs text-gray-500 mb-4">Live rate source: frankfurter.app</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="eurAmount" class="block text-sm font-medium text-gray-700">Amount to Send (EUR)</label>
                            <input type="number" id="eurAmount" placeholder="e.g., 1000" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="manualRate" class="block text-sm font-medium text-gray-700">Manual EUR/TRY Rate</label>
                            <input type="number" id="manualRate" placeholder="Leave blank for live rate" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div class="md:col-span-2">
                             <label for="expenseValue" class="block text-sm font-medium text-gray-700">Sending Expense</label>
                             <div class="mt-1 flex rounded-md shadow-sm">
                                <input type="number" id="expenseValue" value="1.1" class="block w-full flex-1 rounded-none rounded-l-md px-3 py-2 border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                <select id="expenseType" class="inline-flex items-center rounded-r-md border border-l-0 border-gray-300 bg-gray-50 px-3 text-sm text-gray-500">
                                    <option value="percent">%</option>
                                    <option value="amount">EUR</option>
                                </select>
                             </div>
                        </div>
                    </div>
                    
                    <div id="conversionResult" class="mt-4 hidden">
                        <div class="step-row">
                            <span class="step-label">Used EUR/TRY Rate</span>
                            <span id="exchangeRate" class="step-value">...</span>
                        </div>
                        <div class="step-row">
                            <span class="step-label">Gross Amount</span>
                            <span id="grossTry" class="step-value">... TRY</span>
                        </div>
                        <div class="step-row">
                            <span id="sendingExpenseLabel" class="step-label">Sending Expense</span>
                            <span id="sendingExpense" class="step-value text-red-600">- ... TRY</span>
                        </div>
                        <div class="step-row pt-4">
                            <span class="step-label font-bold">Net Received Amount</span>
                            <span id="netTryAmount" class="step-value text-xl text-indigo-600">... TRY</span>
                        </div>
                    </div>
                </div>

                <!-- Interest Calculation Section -->
                <div class="bg-gray-50 p-6 rounded-lg mb-8">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">2. Interest Calculation for Period</h2>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                         <div>
                            <label for="monthlyInterestRate" class="block text-sm font-medium text-gray-700">
                                <a href="https://www.garantibbvaportfoy.com.tr/birinci-para-piyasasi-fonu" target="_blank" class="text-indigo-600 hover:underline">Money Fund Monthly Interest Rate (%)</a>
                            </label>
                            <input type="number" id="monthlyInterestRate" value="3.5" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                         </div>
                         <div>
                            <label for="investmentDays" class="block text-sm font-medium text-gray-700">Number of Days to Invest</label>
                            <input type="number" id="investmentDays" value="30" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                         </div>
                     </div>
                    
                    <div id="interestResult" class="mt-4 hidden">
                         <div class="step-row">
                            <span id="grossInterestLabel" class="step-label">Gross Interest</span>
                            <span id="grossInterest" class="step-value">... TRY</span>
                        </div>
                        <div class="step-row">
                            <span class="step-label">Withholding Tax (15%)</span>
                            <span id="interestTax" class="step-value text-red-600">- ... TRY</span>
                        </div>
                        <div class="step-row pt-4">
                            <span id="netInterestLabel" class="step-label font-bold">Net Interest Income</span>
                            <span id="netInterest" class="step-value text-xl text-green-600">... TRY</span>
                        </div>
                    </div>
                </div>
                
                <!-- Breakeven Analysis Section -->
                <div class="bg-blue-50 p-6 rounded-lg mb-8">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">3. Breakeven FX Rate Analysis</h2>
                    <div id="breakevenResult" class="mt-4 hidden">
                        <p class="text-sm text-gray-700 mb-4">To match the profit from interest, the future exchange rate would need to surpass the rate you would get by converting today.</p>
                        <div class="step-row">
                            <span class="step-label">Total Value (Principal + Net Interest)</span>
                            <span id="totalFutureValue" class="step-value">... TRY</span>
                        </div>
                        <div class="step-row pt-4">
                            <span class="step-label font-bold">Breakeven EUR/TRY Rate</span>
                            <span id="breakevenRate" class="step-value text-xl text-blue-600">...</span>
                        </div>
                    </div>
                </div>

                <button id="calculateBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out mb-6">
                    Calculate
                </button>

                 <div id="loading" class="mt-6 text-center hidden">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                    <p class="text-gray-600 mt-2">Fetching live rate...</p>
                </div>
                 <div id="apiError" class="mt-4 p-4 bg-red-50 rounded-lg hidden">
                    <p class="text-sm font-medium text-red-800">Error</p>
                    <p class="text-sm text-red-700 mt-1">Could not perform calculation. Please check all input values and try again.</p>
                </div>

                <div class="mt-8 text-xs text-gray-500 text-center">
                    <p><strong>Disclaimer:</strong> This is a tool for estimation purposes only. Exchange rates and interest rates fluctuate. The sending expense is an estimate. Consult with your financial institution for exact figures.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const calculateBtn = document.getElementById('calculateBtn');
        const eurAmountInput = document.getElementById('eurAmount');
        const manualRateInput = document.getElementById('manualRate');
        const expenseValueInput = document.getElementById('expenseValue');
        const expenseTypeSelect = document.getElementById('expenseType');
        const monthlyInterestRateInput = document.getElementById('monthlyInterestRate');
        const investmentDaysInput = document.getElementById('investmentDays');

        const conversionResultDiv = document.getElementById('conversionResult');
        const interestResultDiv = document.getElementById('interestResult');
        const breakevenResultDiv = document.getElementById('breakevenResult');
        
        const exchangeRateSpan = document.getElementById('exchangeRate');
        const grossTrySpan = document.getElementById('grossTry');
        const sendingExpenseLabel = document.getElementById('sendingExpenseLabel');
        const sendingExpenseSpan = document.getElementById('sendingExpense');
        const netTryAmountSpan = document.getElementById('netTryAmount');
        
        const grossInterestLabel = document.getElementById('grossInterestLabel');
        const grossInterestSpan = document.getElementById('grossInterest');
        const interestTaxSpan = document.getElementById('interestTax');
        const netInterestLabel = document.getElementById('netInterestLabel');
        const netInterestSpan = document.getElementById('netInterest');

        const totalFutureValueSpan = document.getElementById('totalFutureValue');
        const breakevenRateSpan = document.getElementById('breakevenRate');

        const loadingDiv = document.getElementById('loading');
        const apiErrorDiv = document.getElementById('apiError');
        
        const INTEREST_TAX_RATE = 0.15; // 15%

        calculateBtn.addEventListener('click', performCalculations);
        
        function runCalculations(eurToTryRate) {
            const eurAmount = parseFloat(eurAmountInput.value);
            const monthlyInterestRate = parseFloat(monthlyInterestRateInput.value);
            const investmentDays = parseInt(investmentDaysInput.value);
            const expenseValue = parseFloat(expenseValueInput.value);
            const expenseType = expenseTypeSelect.value;
            
            let expenseAmount, netTryAmount, breakevenRate;

            // 1. Conversion Calculation
            const grossTryAmount = eurAmount * eurToTryRate;

            if (expenseType === 'percent') {
                const sendingExpenseRate = expenseValue / 100;
                expenseAmount = grossTryAmount * sendingExpenseRate;
                netTryAmount = grossTryAmount - expenseAmount;
                sendingExpenseLabel.textContent = `Sending Expense (~${expenseValue}%)`;
            } else { // 'amount'
                expenseAmount = expenseValue * eurToTryRate; // Convert EUR expense to TRY
                netTryAmount = grossTryAmount - expenseAmount;
                sendingExpenseLabel.textContent = `Sending Expense (${expenseValue} EUR)`;
            }

            // 2. Interest Calculation for the period
            const dailyInterestRate = monthlyInterestRate / 30; // Approximate daily rate
            const grossInterestForPeriod = netTryAmount * (dailyInterestRate / 100) * investmentDays;
            const taxOnInterest = grossInterestForPeriod * INTEREST_TAX_RATE;
            const netInterestForPeriod = grossInterestForPeriod - taxOnInterest;

            // 3. Breakeven Calculation
            const totalFutureValue = netTryAmount + netInterestForPeriod;
            
            if (expenseType === 'percent') {
                const sendingExpenseRate = expenseValue / 100;
                const futureGrossTryEquivalent = totalFutureValue / (1 - sendingExpenseRate);
                breakevenRate = futureGrossTryEquivalent / eurAmount;
            } else { // 'amount'
                 breakevenRate = totalFutureValue / (eurAmount - expenseValue);
            }


            // 4. Display Conversion Results
            grossTrySpan.textContent = `${grossTryAmount.toFixed(2)} TRY`;
            sendingExpenseSpan.textContent = `- ${expenseAmount.toFixed(2)} TRY`;
            netTryAmountSpan.textContent = `${netTryAmount.toFixed(2)} TRY`;

            // 5. Display Interest Results for the period
            grossInterestLabel.textContent = `Gross Interest for ${investmentDays} Days`;
            netInterestLabel.textContent = `Net Interest for ${investmentDays} Days`;
            grossInterestSpan.textContent = `${grossInterestForPeriod.toFixed(2)} TRY`;
            interestTaxSpan.textContent = `- ${taxOnInterest.toFixed(2)} TRY`;
            netInterestSpan.textContent = `${netInterestForPeriod.toFixed(2)} TRY`;
            
            // 6. Display Breakeven Results
            totalFutureValueSpan.textContent = `${totalFutureValue.toFixed(2)} TRY`;
            breakevenRateSpan.textContent = breakevenRate.toFixed(4);

            conversionResultDiv.classList.remove('hidden');
            interestResultDiv.classList.remove('hidden');
            breakevenResultDiv.classList.remove('hidden');
        }

        async function performCalculations() {
            const eurAmount = parseFloat(eurAmountInput.value);
            const monthlyInterestRate = parseFloat(monthlyInterestRateInput.value);
            const investmentDays = parseInt(investmentDaysInput.value);
            const manualRate = parseFloat(manualRateInput.value);
            const expenseValue = parseFloat(expenseValueInput.value);

            if (isNaN(eurAmount) || eurAmount <= 0 || isNaN(monthlyInterestRate) || monthlyInterestRate < 0 || isNaN(investmentDays) || investmentDays <= 0 || isNaN(expenseValue) || expenseValue < 0) {
                apiErrorDiv.classList.remove('hidden');
                conversionResultDiv.classList.add('hidden');
                interestResultDiv.classList.add('hidden');
                breakevenResultDiv.classList.add('hidden');
                return;
            }
            
            apiErrorDiv.classList.add('hidden');
            conversionResultDiv.classList.add('hidden');
            interestResultDiv.classList.add('hidden');
            breakevenResultDiv.classList.add('hidden');

            try {
                if (!isNaN(manualRate) && manualRate > 0) {
                    exchangeRateSpan.textContent = `${manualRate.toFixed(4)} (Manual)`;
                    runCalculations(manualRate);
                } else {
                    loadingDiv.classList.remove('hidden');
                    const response = await fetch('https://api.frankfurter.app/latest?from=EUR&to=TRY');
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    
                    if (!data || !data.rates || !data.rates.TRY) {
                        throw new Error('Invalid API response.');
                    }
                    const eurToTryRate = data.rates.TRY;
                    exchangeRateSpan.textContent = `${eurToTryRate.toFixed(4)} (Live)`;
                    runCalculations(eurToTryRate);
                }
            } catch (error) {
                console.error("Calculation Error:", error);
                apiErrorDiv.classList.remove('hidden');
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }
    </script>

</body>
</html>
